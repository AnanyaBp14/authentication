<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mocha~Mist ☁️ — Login</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background-color: #fbf7f1; color: #4c3a2f; }

    nav {
      width: 100%; position: fixed; top: 0; left: 0;
      background: rgba(255,255,255,0.9);
      padding: 1rem 2rem; display: flex;
      justify-content: space-between; align-items: center;
      z-index: 20; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    nav .logo { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #6b4024; font-size: 1.3rem; }
    nav .logo img { width: 32px; height: 32px; }
    nav ul { display: flex; list-style: none; gap: 1.5rem; }
    nav ul li a { color: #4c3a2f; text-decoration: none; font-weight: 500; transition: 0.3s; }
    nav ul li a:hover { color: #c49a6c; }

    .hero {
      height: 100vh;
      background: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)),
        url("https://images.unsplash.com/photo-1511920170033-f8396924c348?auto=format&fit=crop&w=2000&q=80") center/cover;
      display: flex; justify-content: center; align-items: center;
      flex-direction: column; padding: 2rem; color: #fff; text-align: center;
    }
    .hero h1 { font-size: 3.2rem; margin-bottom: 1rem; }
    .hero p { max-width: 600px; margin-bottom: 2rem; color: #f8e8d3; }
    .hero button {
      background: #f4e2cf; padding: 0.9rem 2rem; border-radius: 50px;
      border: none; color: #4c3a2f; font-weight: 600; cursor: pointer; transition: 0.3s;
    }
    .hero button:hover { background: #fff; transform: scale(1.05); }

    .login-section { padding: 4rem 1rem; display: flex; justify-content: center; }
    .login-box {
      width: 100%; max-width: 400px; background: #fff; padding: 2rem;
      border-radius: 18px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }

    .input-group { margin-bottom: 1rem; text-align: left; }
    .input-group label { display: block; margin-bottom: 0.2rem; font-weight: 500; }
    .input-group input {
      width: 100%; padding: 0.8rem; border: 1px solid #d9cfc4; border-radius: 10px;
    }

    .role-container { margin: 1.3rem 0; text-align: left; }
    .role-card {
      border: 1px solid #d9cfc4; padding: 0.7rem;
      border-radius: 10px; cursor: pointer; margin-bottom: 0.5rem; transition: 0.2s;
    }
    .role-card.selected { border: 2px solid #c49a6c; background: #f4e2cf; }

    .login-btn {
      width: 100%; padding: 0.9rem; background: #6b4024; color: #fff;
      border: none; border-radius: 10px; cursor: pointer; font-size: 1rem;
    }
    .login-btn:hover { background: #4a2b16; }

    footer { margin-top: 4rem; background:#6b4024; color:#fff; text-align:center; padding:1rem; }
  </style>
</head>
<body>

  <nav>
    <div class="logo"><img src="brown-coffee-cup-logo.png"> Mocha~Mist</div>
    <ul><li><a href="#home">Home</a></li><li><a href="#login">Login</a></li></ul>
  </nav>

  <section class="hero" id="home">
    <h1>Welcome to Mocha~Mist ☁️</h1>
    <p>Cloud-powered coffee ordering — connecting Customers & Baristas.</p>
    <button onclick="location.href='#login'">Login Now</button>
  </section>

  <section class="login-section" id="login">
    <div class="login-box">
      <img src="brown-coffee-cup-logo.png" width="80">
      <h2>Login</h2>

      <form id="loginForm">
        <div class="input-group">
          <label>Email</label>
          <input id="email" type="email" required />
        </div>
        <div class="input-group">
          <label>Password</label>
          <input id="password" type="password" required />
        </div>

        <div class="role-container">
          <p>Select Role</p>
          <div class="role-card selected" data-role="customer">Customer</div>
          <div class="role-card" data-role="barista">Barista</div>
        </div>

        <button type="submit" class="login-btn">Sign In</button>
      </form>
    </div>
  </section>

  <footer>© 2025 Mocha~Mist — All Rights Reserved</footer>

  <script>
    document.querySelectorAll(".role-card").forEach(card => {
      card.addEventListener("click", () => {
        document.querySelectorAll(".role-card").forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const backendURL = "https://mochamist.onrender.com";

      document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const role = document.querySelector(".role-card.selected").dataset.role;

        console.log("LOGIN REQUEST:", { email, role });

        try {
          const res = await fetch(`${backendURL}/api/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ email, password, role })
          });

          const data = await res.json();
          console.log("LOGIN RESPONSE:", data);

          if (!res.ok) {
            alert(data.message || "Invalid login");
            return;
          }

          localStorage.setItem("accessToken", data.accessToken);
          localStorage.setItem("user", JSON.stringify(data.user));

          if (data.user.role === "customer") {
            window.location.href = "customer.html";
          } else {
            window.location.href = "barista.html";
          }

        } catch (err) {
          console.error("Login error:", err);
          alert("Network error");
        }
      });

    });
  </script>

</body>
</html>
